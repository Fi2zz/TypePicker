!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.DatePicker=t()}(this,function(){"use strict";function e(e,t,a){if(void 0===a&&(a="month"),e||(e=new Date),t||(t=new Date),"month"===a)return Math.abs(12*e.getFullYear()+e.getMonth()-(12*t.getFullYear()+t.getMonth()));if("days"===a){var n=new Date(e.getFullYear(),e.getMonth(),e.getDate()),i=new Date(t.getFullYear(),t.getMonth(),t.getDate());return Math.round(n-i)/864e5}}function t(e,t,a){if(void 0===a&&(a=void 0),!e)return null;var n=e.getAttribute(t);return void 0===a&&(a=""),n||e.setAttribute(t,a)}function a(e){return"[object Array]"===B(e)}function n(e){return"[object Object]"===B(e)}function i(e){return"[object Number]"===B(e)}function r(e){return"[object Date]"===B(e)}function l(e,t){return!!(e&&t&&e.className&&-1!=e.className.search(new RegExp("\\b"+t+"\\b")))}function s(e,t){!e||!t||e.className&&-1!=e.className.search(new RegExp("\\b"+t+"\\b"))||(e.className+=(e.className?" ":"")+t)}function d(e,t){!e||!t||e.className&&-1==e.className.search(new RegExp("\\b"+t+"\\b"))||(e.className=e.className.replace(new RegExp("\\s*\\b"+t+"\\b","g"),""))}function o(e){return e?e.indexOf("#")>=0?document.querySelector(e):e.indexOf(".")>=0?document.querySelectorAll(e)[0]:e.indexOf("#")<=-1||e.indexOf(".")<=-1?(g("ParseEl ","do not mount DatePicker to a pure html tag,"+e),!1):document.querySelector(e):null}function u(e){var t,a=e.locale.toLowerCase(),n=e.pack,i=n.months,r=n.days;return t="en"===a||"en-us"===a||"en-gb"===a?function(e,t){return i[t]+" "+e}:function(e,t){return""+e+n.year+i[t]},{week:r,title:t}}function c(e,t){return t&&e[t]?{locale:t,pack:e[t]}:U}function h(e){window.setTimeout(e,0)}function f(e){window.clearTimeout(e)}function g(e,t){var i=t;(n(t)||a(t))&&(i=JSON.stringify(t)),console.error("["+e+"] "+i+" ")}function v(t){var a=t.date,n=t.infiniteMode,i=t.endDate,r=["calendar-cell","calendar-date-cell"];return a?(n||(e(a,Z,"days")<0&&r.push("disabled"),i&&e(a,i,"days")>0&&r.push("disabled")),0===a.getDay()&&r.push("calendar-cell-weekend"),6===a.getDay()&&r.push("calendar-cell-weekday")):r.push("disabled","empty"),r.join(" ")}function m(e){for(var t=e.year,a=e.month,n=e.infiniteMode,i=e.formatter,r=e.endDate,l=[],s=new Date(t,a,1),d={year:s.getFullYear(),month:s.getMonth(),date:s.getDate(),index:s.getMonth()},o=H(d.year,d.month),u=0;u<o;u++)l.push({date:"",className:v({}),text:D(),key:""});for(u=1;u<=W(d.year,d.month);u++){var c=new Date(d.year,d.month,u),h=i(c),f=h.value,g=D(h.date),m=v({date:c,infiniteMode:n,endDate:r});l.push({className:m,text:g,key:f})}return{template:l.map(function(e){return p(e.className,e.key,e.text)}).join(" "),year:d.year,month:d.index}}function D(e){return'<div class="date">'+(e||"")+'</div><div class="placeholder"></div>'}function p(e,t,a){return'<div class="'+e+'"'+(t?"data-date="+t:"")+">"+a+"</div>"}function w(e){for(var t=e.startDate,a=e.endDate,n=e.gap,i=e.infiniteMode,r=e.formatter,l=e.parse,s=[],d=0;d<=n;d++){var o=new Date(t.getFullYear(),t.getMonth()+d,1),u=m({year:o.getFullYear(),month:o.getMonth(),formatter:r,parse:l,infiniteMode:i,endDate:a});s.push({template:u.template,year:u.year,month:u.month})}return s}function y(e){var t=e.template,a=e.multiViews,n=e.flatView,i=e.singleView,r=e.language,l=r.week.map(function(e,t){return'<div class="'+["calendar-cell","calendar-day-cell",0===t?"calendar-cell-weekday":6===t?"calendar-cell-weekend":""].join(" ")+'">'+e+"</div>"}).join(""),s=t.map(function(e){var t=e.year,n=e.month,s='<div class="calendar-title">'+r.title(t,n)+"</div>",d=e.template,o="";return a||i?o+="<div class='calendar-main'>\n                    <div class=\"calendar-head\">"+s+'</div>\n                   <div class="calendar-day"> '+l+'</div>\n                    <div class="calendar-body">'+d+"</div>\n              </div>":o='<div class="calendar-main">\n                   <div class="calendar-head">'+s+'</div>  \n                    <div class="calendar-body">'+d+"</div>\n            </div>",o});return n&&s.unshift('<div class="calendar-day">'+l+"</div>"),s.join("")}function b(e){return e?"<div class=\"calendar-action-bar\">\n            <button class='calendar-action calendar-action-prev'><span>prev</span></button>\n            <button class='calendar-action calendar-action-next'><span>next</span></button>\n         </div>\n    ":""}function M(t){var a=t.startDate,n=t.endDate,i=t.multiViews,r=t.flatView,l=t.singleView,s=t.language,d=t.infiniteMode,o=t.parse,u=t.formatter,c={template:w({startDate:a,endDate:n,gap:i?1:r?e(a,n):0,infiniteMode:d,formatter:u,parse:o}),multiViews:i,flatView:r,language:s,singleView:l};return""+b(i||l)+y(c)}function Y(e,a,n){for(var i=[],r=0;r<e.length;r++){var l=t(e[r],"data-date");l&&i.push(l)}for(var s=-1,d=-1,r=0;r<i.length;r++){var o=i[r];o===a?s=r:o===n&&(d=r)}return d===s||d<0?[]:i.slice(s+1,d)}function V(a,n,i,r){for(var l=[],d=i[0],o=i[i.length-1],u=0;u<a.length;u++){var c=a[u],h=a[u+1];if(i.length>0){var f=t(a[u],"data-date");f===d?s(c,"start-date"):f===o&&s(c,"end-date")}else if(c&&h){var g=t(c,"data-date"),v=t(h,"data-date");g&&v&&e(r(g),G,"days")>=0&&(n(v)&&n(g)||n(g)&&!n(v))&&l.length<2&&(s(c,"start-date"),s(h,"end-date"),l.push(g,v))}}return i.length>0&&(l=i),l}function S(e,t,a,n){if(a)for(var i=t.querySelectorAll(".in-range"),r=0;r<i.length;r++)d(i[r],"in-range");else for(r=0;r<e.length;r++){var o=$("data-date",e[r]),u=t.querySelector(o);l(u,"active")||s(u,"in-range")}if(n)return[]}function k(t){var a=t.collector,n=t.collection,i=t.data,r=t.isDouble,l=t.parse,d=t.format,o=t.inDates,u=t.isInit,c=[];if(r){if(i.length>=2){var h=i[0],f=i[i.length-1];o(h)||(i=[]);for(var g=l(h),v=l(f),m=g.getFullYear(),D=g.getMonth(),p=g.getDate(),w=[],y=e(v,g,"days")+1,b=0;b<y;b++){var M=d(new Date(m,D,p+b)).value;o(M)||w.push(M)}w.length>=2&&(i=[])}(i.length>0&&u||!u)&&(c=V(n,o,i,l));var k=Y(n,c[0],c[c.length-1]);k.length>0&&S(k,a,!1)}else c=i;for(b=0;b<c.length;b++){var F=$("data-date",c[b]);s(a.querySelector(F),"active")}return c}function F(e){if(!e)return new Date;if(e instanceof Date)return e;var t=new Date(e);return t.getTime()?new Date(t.getFullYear(),t.getMonth(),t.getDate()):null}function x(e,t,a){void 0===a&&(a=!0);var n=a;t||(t="YYYY-MM-DD");var i={DD:n?C(e.getDate()):e.getDate(),dd:n?C(e.getDate()):e.getDate(),MM:n?C(e.getMonth()+1):e.getMonth()+1,mm:n?C(e.getMonth()+1):e.getMonth()+1,YYYY:e.getFullYear(),D:e.getDate(),d:e.getDate(),M:e.getMonth()+1,m:e.getMonth()+1};return{origin:e,date:n?i.DD:i.D,month:n?i.MM:i.M,year:i.YYYY,day:e.getDay(),value:t.replace(/(?:\b|%)([dDMyYHhaAmsz]+|ap|AP)(?:\b|%)/g,function(e,t){return void 0===i[t]?t:i[t]})}}function R(e,t){t||(t="YYYY-MM-DD");var a=F(e);if(a)return a;var n=/d{1,4}|M{1,4}|YY(?:YY)?|S{1,3}|Do|ZZ|([HhMsDm])\1?|[aA]|"[^"]*"|'[^']*'/g,i={D:[/\d{1,2}/,function(e,t){return e.day=parseInt(t)}],M:[/\d{1,2}/,function(e,t){return e.month=parseInt(t)-1}],DD:[/\d{2}/,function(e,t){return e.day=parseInt(t)}],MM:[/\d{2}/,function(e,t){return e.month=parseInt(t)-1}],YY:[/\d{2,4}/,function(e,t){return e.year=parseInt(t)}],YYYY:[/\d{2,4}/,function(e,t){return e.year=parseInt(t)}]};return(a=function(e,t){if(e.length>1e3)return null;var a=!0,r={year:0,month:0,day:0};if(t.replace(n,function(t){if(i[t]){var n=i[t],l=n[0],s=n[n.length-1],d=e.search(l);~d?e.replace(n[0],function(t){return s(r,t),e=e.substr(d+t.length),t}):a=!1}return i[t]?"":t.slice(1,t.length-1)}),!a)return null;var l=new Date(r.year,r.month,r.day);return new Date(l.getFullYear(),l.getMonth(),l.getDate())})(e,t)}function N(e){var t={year:this.date.getFullYear(),month:this.date.getMonth(),date:this.date.getDate()},a=t.month+e;this.multiViews&&(a+=e>0?1:-1),this.defaultDates.length>0&&(this.selected=this.defaultDates),this.date=new Date(t.year,a,t.date),this.createDatePicker(!1),this.pickDate(),this.dataRenderer(this.data)}function j(e){this.element.innerHTML=M({startDate:this.date,endDate:this.endDate,multiViews:this.multiViews,flatView:this.flatView,singleView:this.singleView,language:this.language,infiniteMode:this.infiniteMode,formatter:this.format,parse:this.parse}),this.bindMonthSwitch(this.language),this.selected=this.currentRange(this.isInitRange);var t={type:"init",value:this.selected};e&&this.update(t)}function q(e){var t=this.defaultDates.length>0?this.defaultDates:this.double?this.selected:[this.format(this.date).value];return k({collector:this.element,collection:this.element.querySelectorAll(".calendar-date-cell:not(.empty)"),data:t,isDouble:this.double,parse:this.parse,format:this.format,inDates:this.inDates,isInit:e})}function I(){var t=this,a=new Date(this.startDate).getTime(),n=new Date(this.date).getTime(),i=this.element.querySelector(".calendar-action-prev"),r=this.element.querySelector(".calendar-action-next");i&&r&&(this.infiniteMode?(r.addEventListener("click",function(){t.monthSwitch(1)}),i.addEventListener("click",function(){t.monthSwitch(-1)})):(e(this.date,this.endDate)>=2?r.addEventListener("click",function(){t.monthSwitch(1),d(i,"disabled"),d(i,"calendar-action-disabled")}):(s(r,"disabled"),s(r,"calendar-action-disabled")),n>a?i.addEventListener("click",function(){t.monthSwitch(-1),d(r,"disabled"),d(r,"calendar-action-disabled")}):(s(i,"disabled"),s(i,"calendar-action-disabled"))))}function P(t,a){var n=this,l=this;if(t.initWithSelected&&(this.initWithSelected=t.initWithSelected),t.doubleSelect&&(this.double=t.doubleSelect),t.format&&(this.dateFormat=t.format||"YYYY-MM-DD"),!t.multiViews||t.flatView||t.singleView?!t.flatView||t.singleView||t.multiViews?!t.singleView||t.multiViews||t.flatView||(this.singleView=!0):this.flatView=!0:this.multiViews=!0,this.startDate=r(t.from)?t.from:new Date,this.date=this.startDate,this.endDate=r(t.to)?t.to:new Date(this.date.getFullYear(),this.date.getMonth()+6,0),this.limit=this.double&&i(t.limit)?t.limit:1,t.zeroPadding&&(this.zeroPadding=t.zeroPadding),t.infiniteMode&&(this.infiniteMode=t.infiniteMode),!a.dates||a.dates&&a.dates.length<=0){for(var s=new Date,d=e(this.endDate,s,"days"),v=s.getFullYear(),m=s.getMonth(),D=s.getDate(),p=[],w=0;w<d;w++){var y=new Date(v,m,D+w),b=n.format(y).value;p.push(b)}this.data={},this.dates=p}else this.dates=a.dates,this.data=a.data,this.infiniteMode=!1;if(this.format=function(e){return x(e,l.dateFormat,l.zeroPadding)},this.language=u(c(t.language,t.defaultLanguage)),this.element=o(t.el),!this.element)return g("init","invalid selector,current selector "+this.element),!1;this.element.className=this.element.className+" calendar calendar-"+(this.multiViews?"double-views":this.singleView?"single-view":"flat-view");var M=h(function(){if(l.defaultDates.length>0){var e=l.defaultDates[0];l.flatView||(l.date=l.parse(e))}l.createDatePicker(!0),l.pickDate(),f(M)})}function A(e,t,a){if(a){for(var n=t.querySelectorAll(".active"),i=0;i<n.length;i++)d(n[i],"active");l(e,"disabled")||s(e,"active")}}function O(e,t,a,n,i,r){var o={start:e.querySelector(".start-date"),end:e.querySelector(".end-date")},u={start:e.querySelector($("data-date",t)),end:e.querySelector($("data-date",a))};return 0===n?!l(u.start,"disabled")&&(d(o.start,"start-date"),d(o.start,"active"),d(o.end,"end-date"),d(o.end,"active"),s(u.start,"active"),s(u.start,"start-date"),!0):(s(u.end,"active"),n>0?i?(s(u.end,"start-date"),d(o.start,"start-date"),d(o.start,"active")):r?s(u.end,"end-date"):(d(u.start,"active"),d(u.start,"start-date"),s(u.end,"start-date")):n<0&&(d(u.start,"active"),d(u.start,"start-date"),s(u.end,"start-date")),!0)}function E(t,a){var n=e(t,a,"days");return 0===n?0:-1*n}function L(e){var t=e.selected,a=e.date,n=e.cache,i=e.limit,r=e.format,l=e.parse,s=e.inDates,d=e.bindData,o=[],u=[],c=!1,h=t[0],f=t[t.length-1],g=l(h),v=l(f);if(d){var m=E(g,v),D=t.length;if(D>=2)if(m<=0)s(a)?t.shift():t=[t[0]];else if(s(f))for(var p=g.getFullYear(),w=g.getMonth(),y=g.getDate(),b=1;b<m;b++){var M=r(j=new Date(p,w,y+b)).value;s(M)&&u.push(M),o.push(M)}else s()&&f&&(t.shift(),o.push(f));else if(1===D){var Y=t[t.length-1];if(s(Y))t=[Y];else if(n.length>=2){for(var V=[],b=0;b<n.length;b++)s(n[b])&&V.push(n[b]);if(V.length===n.length){var S=n[0];t=S!==n[n.length-1]?n:[S]}else t=[]}else t=[n[0]]}else t=n;if(t.length<=0&&(t=n),(c=o.length===u.length)||(t=[t[t.length-1]]),2===t.length){var k=null,F=l(t[t.length-1]),x=l(t[0]),R=-1*E(F,x);if(R>0){var p=x.getFullYear(),w=x.getMonth(),N=x.getDate();o=[],u=[];for(b=0;b<R;b++){var j=new Date(p,w,N+b),q=r(j).value;s(q)&&(k=j,u.push(q)),~o.indexOf(q)||o.push(q)}var I=E(k,F);1===I||-1===I?c=!0:(o=[],t=[t[0]],c=!1)}if(u.length===o.length?c=!0:(c=!1,t=[t[0]]),o.length>i){c=!1;var P=t[t.length-1];t=s(P)?[P]:[n[0]]}}}else{t.length>=2&&h===f&&t.pop();var A=E(g,v);if(A>0&&A<=i){for(b=1;b<A;b++){var O=new Date(g.getFullYear(),g.getMonth(),g.getDate()+b);o.push(r(O).value)}c=!0}else(A>i||A<0)&&t.shift()}return{selected:t,allValid:c,range:o}}function z(e,t){var a=this;if(e.bindData){var i={dates:[],data:{},from:Date,to:Date},l=t&&t(i),s=l||i;r(i.from)&&(e.from=i.from),r(i.to)&&(e.to=i.to);var d={data:s.data,dates:s.dates.sort(function(e,t){return a.parse(e)-a.parse(t)})};this.init(e,d),function(e){return!n(e)||Object.keys(e.data).length<=0||e.dates.length<=0}(s)||this.dataRenderer(s.data)}}var T=function(){var e={};return{$on:function(t,a){e[t]||(e[t]=[]),e[t].push(a)},$emit:function(){for(var t=arguments,a=this,n=[],i=0;i<arguments.length;i++)n[i]=t[i];var r=[].shift.call(n),l=e[r];if(!l||0===l.length)return!1;for(var s=0,d=void 0;d=l[s++];)d.apply(a,n)},$remove:function(t,a){var n=e[t];if(!n)return!1;if(a)for(var i=n.length-1;i>=0;i--)n[i]===a&&n.splice(i,1);else n&&(n.length=0)}}}(),$=function(e,t){return"["+e+'="'+t+'"]'},W=function(e,t){var a=new Date(e,t,1),n=Date.UTC(a.getFullYear(),a.getMonth()+1,0);return new Date(n).getUTCDate()},C=function(e){return""+(e>9?e:"0"+e)},H=function(e,t){return new Date(e,t,1).getDay()},B=function(e){return Object.prototype.toString.call(e)},U={locale:"zh-cn",pack:{days:["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"],months:["01\u6708","02\u6708","03\u6708","04\u6708","05\u6708","06\u6708","07\u6708","08\u6708","09\u6708","10\u6708","11\u6708","12\u6708"],year:"\u5e74"}},Z=new Date,J=new Date,G=new Date(J.getFullYear(),J.getMonth(),J.getDate()),K=function(e){for(var a=e.element,n=e.selected,i=e.isDouble,r=e.parse,l=e.format,s=e.limit,d=e.inDates,o=e.update,u=e.infiniteMode,c=e.bindData,h=n,f=a.querySelectorAll(".calendar-date-cell"),g=0;g<f.length;g++)!function(e){var g=f[e];g.addEventListener("click",function(){var e=n,f=t(g,"data-date"),v=n.indexOf(f);if(!f||n.length<=0&&!d(f)&&c)return!1;if(v>=0&&(n=[n[0]]),(i&&n.length>=2||!i)&&(n=[]),n.push(f),i){var m=L({date:f,selected:n,cache:e,limit:s,format:l,parse:r,inDates:d,infiniteMode:u,bindData:c});n=m.selected;var D=m.range,p=m.allValid,w=n[0],y=n[n.length-1],b=E(r(w),r(y)),M=O(a,w,y,b,b>s,p);M&&S([],a,!0),p&&M&&S(D,a,!1)}else{var Y=g,V=!0;d(f)||(n=e,V=!1),A(Y,a,V)}var k=i&&h.join("-")===n.join("-")?"disabled":"selected";o({type:k,value:n})})}(g)};return function(){return function(t){var n=this;return this.init=P,this.date=new Date,this.limit=1,this.double=!1,this.element=null,this.startDate=new Date,this.endDate=null,this.selected=[],this.flatView=!1,this.multiViews=!1,this.singleView=!1,this.monthSwitch=N,this.createDatePicker=j,this.zeroPadding=!1,this.initWithSelected=!1,this.bindData=!1,this.infiniteMode=!1,this.currentRange=q,this.isInitRange=!1,this.language={},this.pickDate=function(){K({element:n.element,selected:n.selected,isDouble:n.double,source:n.dates,parse:n.parse,format:n.format,limit:n.limit,inDates:n.inDates,update:n.update,infiniteMode:n.infiniteMode,bindData:n.bindData})},this.format=function(e){return x(e,n.dateFormat,n.zeroPadding)},this.parse=function(e){return R(e,n.dateFormat)},this.inDates=function(e){return n.dates.indexOf(e)>=0},this.update=function(e){"selected"===e.type&&n.dateRanges(e.value,!1),T.$emit("update",e)},this.dataRenderer=function(e){if(Object.keys(e).length<=0)T.$remove("data");else var t=h(function(){T.$emit("data",{data:e,nodeList:n.element.querySelectorAll(".calendar-cell")}),f(t)})},this.dateRanges=function(t,i){if(!a(t))return t=[],void g("dateRanges","no dates provided,"+t);n.isInitRange=!!i;var l=function(){var a=[],i="",l="";if(n.double){t.length>2&&(t=t.slice(0,2)),i=t[0],l=t[t.length-1];var s=r(i)?i:n.parse(i),d=r(l)?l:n.parse(l),o=-1*e(s,d,"days");if(n.bindData&&(o<0||o>n.limit||!n.inDates(n.format(s).value)&&!n.inDates(n.format(d).value)||!n.inDates(n.format(s).value)))return g("dateRanges","Illegal dates,["+t+"]"),!1;for(var u=0;u<=o;u++){var c=new Date(s.getFullYear(),s.getMonth(),s.getDate()+u),h=n.format(c).value;if(u<o&&!n.inDates(h))return g("dateRanges","Illegal date,{dates:["+h+"]}"),!1}a=[n.format(s).value,n.format(d).value]}else{var f=t[t.length-1];a=[r(f)?n.format(f).value:f]}n.defaultDates=a};if(n.bindData)var s=h(function(){l(),f(s)});else l()},this.bindMonthSwitch=I,this.initWithDataBind=z,this.utils={format:function(e,t){return e&&t?x(e,t).value:null},parse:function(e,t){return e&&t?R(e,t):new Date},diff:function(t,a){return e(t,a,"days")}},t?(this.defaultDates=[],this.bindData=t.bindData,!t.bindData&&t.el&&this.init(t,{}),{on:T.$on,data:function(e){return n.initWithDataBind(t,e)},diff:function(t,a){return e(t,a,"days")},parse:this.parse,format:this.format,dateRanges:this.dateRanges,setDefaultDates:this.dateRanges}):{format:function(e,t){return e&&t?x(e,t).value:null},parse:function(e,t){return e&&t?R(e,t):new Date},diff:function(t,a){return e(t,a,"days")}}}}()});