!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.DatePicker=t()}(this,function(){"use strict";var e,t=(e={},{$on:function(t,a){e[t]||(e[t]=[]),e[t].push(a)},$emit:function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];var n=[].shift.call(t),r=e[n];if(!r||0===r.length)return!1;for(var i=0,s=void 0;s=r[i++];)s.apply(this,t)},$remove:function(t,a){var n=e[t];if(!n)return!1;if(a)for(var r=n.length-1;r>=0;r--)n[r]===a&&n.splice(r,1);else n&&(n.length=0)}});function a(e,t){t||(t="YYYY-MM-DD"),t=t.toUpperCase();var a={YYYY:e.getFullYear(),DD:l(e.getDate()),MM:l(e.getMonth()+1),D:e.getDate(),M:e.getMonth()+1},n=function(e){var t=e.split(/\W/,3);t.shift();for(var a=[],n=0;n<t.length;n++){var r=t[n];/\w\w/.test(r)&&a.push(r)}return t.length===a.length}(t);return{origin:e,date:n?a.DD:a.D,month:n?a.MM:a.M,year:a.YYYY,day:e.getDay(),value:t.replace(/(?:\b|%)([dDMyY]+)(?:\b|%)/g,function(e,t){return void 0===a[t]?t:a[t]})}}function n(e,t){t||(t="YYYY-MM-DD");var a=function(e){if(!e)return new Date;if(e instanceof Date)return e;var t=new Date(e);return t.getTime()?new Date(t.getFullYear(),t.getMonth(),t.getDate()):null}(e);if(a)return a;var n=/d{1,4}|M{1,4}|YY(?:YY)?|S{1,3}|Do|ZZ|([HhMsDm])\1?|[aA]|"[^"]*"|'[^']*'/g,r={D:[/\d{1,2}/,function(e,t){return e.day=parseInt(t)}],M:[/\d{1,2}/,function(e,t){return e.month=parseInt(t)-1}],DD:[/\d{2}/,function(e,t){return e.day=parseInt(t)}],MM:[/\d{2}/,function(e,t){return e.month=parseInt(t)-1}],YY:[/\d{2,4}/,function(e,t){return e.year=parseInt(t)}],YYYY:[/\d{2,4}/,function(e,t){return e.year=parseInt(t)}]};return(a=function(e,t){if(e.length>1e3)return null;var a=!0,i={year:0,month:0,day:0};if(t.replace(n,function(t){if(r[t]){var n=r[t],s=n[0],o=n[n.length-1],l=e.search(s);~l?e.replace(n[0],function(t){return o(i,t),e=e.substr(l+t.length),t}):a=!1}return r[t]?"":t.slice(1,t.length-1)}),!a)return null;var s=new Date(i.year,i.month,i.day);return new Date(s.getFullYear(),s.getMonth(),s.getDate())})(e,t)}var r=function(e,t){return"["+e+'="'+t+'"]'};function i(e){return parseInt(e,10)}function s(e,t,a){var n;if(void 0===a&&(a="month"),e&&t||(n=0),"month"===a)n=12*e.getFullYear()+e.getMonth()-(12*t.getFullYear()+t.getMonth());else if("days"===a){var r=new Date(e.getFullYear(),e.getMonth(),e.getDate()),i=new Date(t.getFullYear(),t.getMonth(),t.getDate());n=Math.round(r-i)/864e5}return Math.abs(n)}var o=function(e,t){var a=new Date(e,t,1),n=Date.UTC(a.getFullYear(),a.getMonth()+1,0);return new Date(n).getUTCDate()},l=function(e){return""+(e>9?e:"0"+e)};function d(e){return Object.prototype.toString.call(e)}function c(e){return"[object Array]"===d(e)}function u(e){return"[object Object]"===d(e)}function h(e){return"[object Date]"===d(e)}function f(e,t){!e||!t||e.className&&-1!=e.className.search(new RegExp("\\b"+t+"\\b"))||(e.className+=(e.className?" ":"")+t)}function v(e,t){!e||!t||e.className&&-1==e.className.search(new RegExp("\\b"+t+"\\b"))||(e.className=e.className.replace(new RegExp("\\s*\\b"+t+"\\b","g"),""))}function p(e,t){var a=t;(u(t)||c(t))&&(a=JSON.stringify(t)),console.error("["+e+"] "+a+" ")}function m(e){return e?"[object String]"!==d(e)?e:e.indexOf("#")>=0?document.querySelector(e):e.indexOf(".")>=0?document.querySelectorAll(e)[0]:e.indexOf("#")<=-1||e.indexOf(".")<=-1?(p("ParseEl","Do not mount DatePicker to a pure html tag,"+e),!1):document.querySelector(e):null}function g(e){return e[0]}function D(e){return e[e.length-1]}function y(e,t){var a=s(e,t,"days");return 0===a?0:-1*a}function b(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var a={};function n(e,t){return a=e,Object.prototype.toString.call(a)==="[object "+t+"]";var a}function r(e,t){for(var a in void 0===e&&(e={}),t)t.hasOwnProperty(a)&&(e[a]=t[a]);return e}for(var i=0;i<e.length;i++){var s=e[i];if(s)if(n(s,"Array"))for(var o=0;o<s.length;o++){var l=s[o];n(l,"Object")?a=r(a,l):n(l,"Date")||(a[l]=l)}else n(s,"Object")?a=r(a,s):(n(s,"String")||n(s,"Number"))&&(a[s]=s)}return a}function w(e){if(!c(e)&&!u(e))return p("isEmpty","Expect an Object or an Array,but got "+d(e)),!1;if(c(e))return e.length<=0;if(u(e)){for(var t in e)if(t)return!1;return!0}}function M(e,t,r,i){var o,l=g(e),d=D(e),c=[],u=[];if(l&&d){var f=s(o=h(l)?l:n(l,t),h(d)?d:n(d,t),"days");if(f>0&&f<=r)for(var v=0;v<f;v++){var p=a(new Date(o.getFullYear(),o.getMonth(),o.getDate()+v),t).value;!i(p)&&v<f-1?c.push(p):u.push(p)}}return{invalidDates:c,validDates:u}}var Y=function(){function e(e){var t=this;this.formatter=function(e){return a(e,t.dateFormat)},this.language={},this.views=1;var n=e.startDate,r=e.views,i=e.language,s=e.dateFormat,o=e.diff;this.dateFormat=s;var l=2===r?1:"auto"===r?o:0;this.language=i,this.views=r,this.template=""+this.createActionBar("auto"!==this.views)+this.createView(this.createBody(l,n))}return e.prototype.createActionBar=function(e){return e?"<div class=\"calendar-action-bar\">\n            <button class='calendar-action calendar-action-prev'><span>prev</span></button>\n            <button class='calendar-action calendar-action-next'><span>next</span></button>\n         </div>\n    ":""},e.prototype.createBody=function(e,t){for(var a=[],n=0;n<=e;n++){var r=new Date(t.getFullYear(),t.getMonth()+n,1),i=this.createMonthDateTemplate(r.getFullYear(),r.getMonth());a.push({template:i.template,year:i.year,month:i.month})}return a},e.prototype.createMonthDateTemplate=function(e,t){for(var a=this,n=new Date(e,t,1),r={year:n.getFullYear(),month:n.getMonth(),date:n.getDate(),index:n.getMonth()},i=new Date(r.year,r.month,1).getDay(),s=[],l=0;l<i;l++)s.push({date:"",className:this.setNodeClassName(),text:this.createPlaceholder(),key:""});for(l=1;l<=o(r.year,r.month);l++){var d=new Date(r.year,r.month,l),c=this.formatter(d),u=c.value,h=this.createPlaceholder(c.date),f=this.setNodeClassName(d),v=c.day;s.push({className:f,text:h,key:u,day:v})}return{template:s.map(function(e){return a.createNode(e.className,e.key,e.text,e.day)}).join(" "),year:r.year,month:r.index}},e.prototype.createView=function(e){var t=this,a=this.createMonthWeek(),n=e.map(function(e){var n=e.year,r=e.month,i=t.createMonthHeader(n,r),s=t.createMonthBody(e.template),o="";return"auto"!==t.views?o+=t.createMonthWrap(i,s,a):o=t.createMonthWrap(i,s),o});return"auto"===this.views&&n.unshift(a),n.join("")},e.prototype.createMonthWrap=function(e,t,a){return'<div class="calendar-main">'+e+" "+(a||"")+" "+t+"</div>"},e.prototype.createMonthWeek=function(){return'  <div class="calendar-day">'+this.language.days.map(function(e,t){return'<div class="'+["calendar-cell","calendar-day-cell",0===t?"calendar-cell-weekday":6===t?"calendar-cell-weekend":""].join(" ")+'">'+e+"</div>"}).join("")+"</div>"},e.prototype.createMonthBody=function(e){return'<div class="calendar-body">'+e+"</div>"},e.prototype.createMonthHeader=function(e,t){var a,n,r;return'<div class="calendar-head"><div class="calendar-title">'+(a=this.language,n=e,r=t,a.year?""+n+a.year+a.months[r]:a.months[r]+" "+n)+"</div></div>"},e.prototype.createNode=function(e,t,a,n){return'<div class="'+e+'" '+(n>=0?"data-day="+n:"")+" "+(t?"data-date="+t:"")+">"+a+"</div>"},e.prototype.createPlaceholder=function(e){return'<div class="date">'+(e||"")+'</div><div class="placeholder"></div>'},e.prototype.setNodeClassName=function(e){var t=["calendar-cell","calendar-date-cell"];return e?(0===e.getDay()&&t.push("calendar-cell-weekend"),6===e.getDay()&&t.push("calendar-cell-weekday")):t.push("disabled","empty"),t.join(" ")},e}(),F=function(e){for(var r=e.element,i=e.selected,s=e.isDouble,o=e.limit,l=e.inDates,d=e.bindData,c=e.dateFormat,u=e.infiniteMode,h=r.querySelectorAll(".calendar-date-cell"),f=i,v=function(e){var r=h[e];r.addEventListener("click",function(){var e=i,h="selected",v=function(e,t,a){if(void 0===a&&(a=void 0),!e)return null;var n=e.getAttribute(t);return void 0===a&&(a=""),n||e.setAttribute(t,a)}(r,"data-date"),p=i.indexOf(v),m=n(v,c),b=a(new Date(m.getFullYear(),m.getMonth(),m.getDate()-1),c).value,w=l(b);if(!v||i.length<=0&&!l(v)&&d&&!u||s&&!w&&!l(v)&&!u||p>=0&&!l(v)&&!u)return!1;if(p>=0&&(i=l(D(i))?[D(i)]:[g(i)]),(s&&i.length>=2||!s)&&(i=[]),i.push(v),s){var M={start:g(i),end:D(i)};y(n(M.start,c),n(M.end,c))<0?l(M.end)?i=[v]:i.pop():l(M.end)||w||(i=[M.start]);for(var Y=function(e,t){var r=e.selected,i=g(r),s=D(r),o=n(i,e.dateFormat),l=n(s,e.dateFormat),d=[];i===s&&r.length>=2&&r.pop();var c=y(o,l);if(c>0)if(c<=e.limit)for(var u=1;u<c;u++){var h=a(new Date(o.getFullYear(),o.getMonth(),o.getDate()+u),e.dateFormat).value;d.push(h)}else t(s)?r.shift():r.pop();else c<=0&&r.length>=2&&r.pop();return{dates:d,selected:r}}({date:v,dateFormat:c,selected:i,limit:o},l),F=D(Y.selected),N=[],k=0,x=Y.dates;k<x.length;k++){var j=x[k];l(j)||N.push(j)}N.length>0&&Y.selected.length>=2&&(l(F)?Y.selected.shift():Y.selected.pop()),Y.selected.length<=1&&(l(F)||(Y.selected=e,h="disabled")),i=Y.selected}else i=l(v)?i:f,h=l(v)?"selected":"disabled";t.$emit("select",{type:h,value:i})})},p=0;p<h.length;p++)v(p)};function N(e,t){console.warn("[deprecated]"+e+" is deprecated "+(t?","+t+" instead":""))}return function(){function e(e){var i=this;this.dates=[],this.limit=1,this.views=1,this.date=new Date,this.startDate=null,this.endDate=null,this.selected=[],this.data={},this.disables={},this.language={days:["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"],months:["01\u6708","02\u6708","03\u6708","04\u6708","05\u6708","06\u6708","07\u6708","08\u6708","09\u6708","10\u6708","11\u6708","12\u6708"],year:"\u5e74"},this.element=null,this.double=!1,this.bindData=!1,this.infiniteMode=!1,this.isInit=!1,this.inDates=function(e){return!w(i.dates)&&i.dates.indexOf(e)>=0},this.format=function(e,t){return a(e,t||i.dateFormat)},this.parse=function(e,t){return n(e,t||i.dateFormat)},e.from&&(N("option.from","use option.startDate"),delete e.from),e.to&&(N("option.to","use option.endDate"),delete e.to),t.$on("select",function(e){var a=e.type,n=e.value;if("disabled"!==a){var s=M(n,i.dateFormat,i.limit,i.inDates);console.log(s,n,i.double),i.double&&function(e,t){for(var a,n,i=t.querySelectorAll(".in-range"),s=0;s<i.length;s++)v(i[s],"in-range");for(s=0;s<e.length;s++){var o=r("data-date",e[s]),l=t.querySelector(o);n="active",(a=l)&&n&&a.className&&-1!=a.className.search(new RegExp("\\b"+n+"\\b"))||f(l,"in-range")}}(s.validDates,i.element),function(e,t,a){for(var n=e.querySelectorAll(".calendar-date-cell"),r=0;r<n.length;r++)v(n[r],"active"),a&&(v(n[r],"start-date"),v(n[r],"end-date"));for(r=0;r<t.length;r++){var i=t[r],s=e.querySelector('[data-date="'+i+'"]');f(s,"active"),a&&(0===r&&f(s,"start-date"),2===t.length&&r===t.length-1&&f(s,"end-date"))}}(i.element,n,i.double),t.$emit("update",e)}}),t.$on("create",function(e){var a=e.type,n=e.size;if("switch"===a){var r={year:i.date.getFullYear(),month:i.date.getMonth(),date:i.date.getDate()};i.date=new Date(r.year,r.month+n,r.date),i.isInit=!1}i.createDatePicker(),"init"===a&&t.$emit("select",{type:"init",value:i.selected}),i.bindData&&t.$emit("data",{data:i.data,nodeList:i.element.querySelectorAll(".calendar-cell")}),w(i.disables)||t.$emit("disabled",{nodeList:i.element.querySelectorAll(".calendar-cell"),dateList:i.disables}),F({dateFormat:i.dateFormat,element:i.element,selected:i.selected,isDouble:i.double,limit:i.limit,bindData:i.bindData,inDates:i.inDates,infiniteMode:i.infiniteMode})}),this.init(e)}return e.prototype.on=function(e,a){return t.$on(e,a)},e.prototype.setDates=function(e){var t=this;if(c(e)){var a=[],n="",r="";if(this.double){e.length>2&&(e=e.slice(0,2)),n=e[0],r=e[e.length-1];var i=h(n)?n:this.parse(n),o=h(r)?r:this.parse(r),l=-1*s(i,o,"days");if(this.bindData)if(!function(a,n,r){if(r<0||r>t.limit||!t.inDates(t.format(a).value)&&!t.inDates(t.format(n).value)||!t.inDates(t.format(a).value))return p("setDates","Illegal dates,["+e+"]"),!1;for(var i=0;i<=r;i++){var s=new Date(a.getFullYear(),a.getMonth(),a.getDate()+i),o=t.format(s).value;if(i<r&&!t.inDates(o))return p("setDates","Illegal date,{dates:["+o+"]}"),!1}return!0}(i,o,l))return!1;a=[this.format(i).value],n!==r&&a.push(this.format(o).value)}else{var d=e[e.length-1];a=[h(d)?this.format(d).value:d]}this.selected=a}else p("setDates","no dates provided,"+(e=[]))},e.prototype.setLanguage=function(e){c(e.days)&&c(e.months)&&(this.language={days:e.days,months:e.months,year:e.year})},e.prototype.setDisabled=function(e){var a=this;if(!e||u(e)&&Object.keys(e).length<=0)return p("setDisabled","invalid params, \nparams should be {dates:<Array<any>>[], days:<Array<number>>[] }"),!1;if(!c(e.dates)&&!c(e.days))return p("setDisabled","invalid params  { dates:<Array<any>>"+e.dates+", days:<Array<number>>"+e.days+" }"),!1;var n,r,s=c(e.dates)?e.dates.map(function(e){return e instanceof Date?a.format(e).value:a.parse(e)instanceof Date?e:void 0}).filter(function(e){return!!e}):[],o=c(e.days)?e.days.filter(function(e){var t=i(e);return!isNaN(t)&&t>=0&&t<=6}):[],l=e.to,d=e.from;if(d){if(h(d))n=d;else{if(!h(f=this.parse(d)))return!1;n=f}this.endDate=n}if(l){if(h(l))r=l;else{var f;if(!h(f=this.parse(l)))return!1;r=f}this.date=r,this.startDate=r}(n||r)&&(this.infiniteMode=!1),t.$emit("setDisabled",{dayList:o,dateList:s})},e.prototype.setData=function(e){if("[object Function]"===d(e)){var t=e();if(u(t)&&Object.keys(t).length>0)for(var n in t){this.parse(n)instanceof Date&&(this.data[n]=t[n])}else p("setData","you are passing wrong type of data to DatePicker,data should be like :\n                    {\n                        "+a(new Date,this.dateFormat).value+':"your value" ,\n                     }')}},e.prototype.diff=function(e,t){return s(e,t,"days")},e.prototype.createDatePicker=function(){this.element.innerHTML=new Y({startDate:this.date,diff:s(this.startDate,this.endDate),language:this.language,views:this.views,dateFormat:this.dateFormat}).template;var e=this.element.querySelector(".calendar-action-prev"),a=this.element.querySelector(".calendar-action-next");e&&a&&(this.infiniteMode?(a.addEventListener("click",function(){return t.$emit("create",{type:"switch",size:1})}),e.addEventListener("click",function(){return t.$emit("create",{type:"switch",size:-1})})):(s(this.date,this.endDate)>1?a.addEventListener("click",function(){t.$emit("create",{type:"switch",size:1}),v(e,"disabled calendar-action-disabled")}):f(a,"disabled calendar-action-disabled"),s(this.date,this.startDate)>=1?e.addEventListener("click",function(){t.$emit("create",{type:"switch",size:-1}),v(a,"disabled calendar-action-disabled")}):f(e,"disabled calendar-action-disabled")))},e.prototype.init=function(e){var n=this,r=new Date;if(e.doubleSelect&&(this.double=e.doubleSelect),this.dateFormat=e.format,this.views=function(e){if(!e)return 1;var t=i(e);return isNaN(t)?"auto"!==e?1:"auto":t>2||t<=0?1:t}(e.views),this.startDate=h(e.startDate)?e.startDate:new Date,h(e.endDate)&&(this.endDate=e.endDate),this.date=this.startDate,this.limit=this.double?"[object Number]"===d(e.limit)?e.limit:2:1,this.element=m(e.el),!this.element)return p("init","invalid selector,current selector "+this.element),!1;var l={};t.$on("setDisabled",function(e){return l=e}),this.element.className=this.element.className+" calendar calendar-"+(2===this.views?"double-views":1===this.views?"single-view":"flat-view");var c,u=(c=function(){var d={};if(n.isInit=n.selected.length>0,n.bindData=!w(n.data),h(e.startDate)&&h(e.endDate)||(n.infiniteMode=!0,n.bindData&&p("init","infiniteMode is on, please provide [startDate] and [endDate] while binding data to datepicker  ")),n.bindData)for(var c in n.data)d[c]=n.parse(c).getDay();else if(h(e.startDate)&&h(e.endDate))for(var f=s(n.endDate,r,"days"),v=r.getFullYear(),m=r.getMonth(),y=r.getDate(),Y=0;Y<f;Y++){var F=new Date(v,m,y+Y);d[n.format(F).value]=F.getDay()}var N=l.dateList,k=l.dayList,x={};for(var y in d){var j=i(d[y]);N.indexOf(y)>=0&&(delete d[y],x[y]||(x[y]=y)),k.indexOf(j)>=0&&(d[y]&&delete d[y],x[y]||(x[y]=y))}var S,O=function(e,t,n,r){var i=e.getDate(),s={};if(r){for(var l=1;l<=i-1;l++)s[c=a(new Date(e.getFullYear(),e.getMonth(),i-l),n).value]=c;var d=o(t.getFullYear(),t.getMonth())-t.getDate();for(l=1;l<=d;l++){var c;s[c=a(new Date(t.getFullYear(),t.getMonth(),t.getDate()+l),n).value]=c}}return s}(n.startDate,n.endDate,n.dateFormat,!n.infiniteMode);n.disables=b(O,x),n.dates=Object.keys(d),(M(n.selected,n.dateFormat,n.limit,n.inDates).invalidDates.length>0||!n.inDates(g(n.selected))&&!n.double)&&(n.selected=[]),"auto"===n.views&&(w(n.selected)?w(n.dates)||(n.date=n.parse(g(n.dates))):n.date=n.parse(g(n.selected))),1===n.views&&n.double&&n.selected.length>=2&&g(n.selected)===D(n.selected)&&n.selected.pop(),t.$emit("create",{type:"init"}),S=u,window.clearTimeout(S)},void window.setTimeout(c,0))},e}()});