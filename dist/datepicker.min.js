!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.DatePicker=e()}(this,function(){"use strict";var t,e=(t={},{$on:function(e,a){t[e]||(t[e]=[]),t[e].push(a)},$emit:function(){for(var e=[],a=0;a<arguments.length;a++)e[a]=arguments[a];var n=[].shift.call(e),r=t[n];if(!r||0===r.length)return!1;for(var i=0,s=void 0;s=r[i++];)s.apply(this,e)},$remove:function(e,a){var n=t[e];if(!n)return!1;if(a)for(var r=n.length-1;r>=0;r--)n[r]===a&&n.splice(r,1);else n&&(n.length=0)}}),a=function(t,e){return"["+t+'="'+e+'"]'};function n(t,e,a){if(void 0===a&&(a=void 0),!t)return null;var n=t.getAttribute(e);return void 0===a&&(a=""),n||t.setAttribute(e,a)}function r(t,e,a){if(void 0===a&&(a="month"),t||(t=new Date),e||(e=new Date),"month"===a)return Math.abs(12*t.getFullYear()+t.getMonth()-(12*e.getFullYear()+e.getMonth()));if("days"===a){var n=new Date(t.getFullYear(),t.getMonth(),t.getDate()),r=new Date(e.getFullYear(),e.getMonth(),e.getDate());return Math.round(n-r)/864e5}}var i=function(t,e){var a=new Date(t,e,1),n=Date.UTC(a.getFullYear(),a.getMonth()+1,0);return new Date(n).getUTCDate()},s=function(t){return""+(t>9?t:"0"+t)};function o(t){return Object.prototype.toString.call(t)}function l(t){return"[object Array]"===o(t)}function d(t){return"[object Object]"===o(t)}function c(t){return"[object Date]"===o(t)}function u(t,e){return!!(t&&e&&t.className&&-1!=t.className.search(new RegExp("\\b"+e+"\\b")))}function h(t,e){!t||!e||t.className&&-1!=t.className.search(new RegExp("\\b"+e+"\\b"))||(t.className+=(t.className?" ":"")+e)}function f(t,e){!t||!e||t.className&&-1==t.className.search(new RegExp("\\b"+e+"\\b"))||(t.className=t.className.replace(new RegExp("\\s*\\b"+e+"\\b","g"),""))}function v(t){window.setTimeout(t,0)}function g(t){window.clearTimeout(t)}function p(t,e){var a=e;(d(e)||l(e))&&(a=JSON.stringify(e)),console.error("["+t+"] "+a+" ")}function m(t){return t?"[object String]"!==o(t)?t:t.indexOf("#")>=0?document.querySelector(t):t.indexOf(".")>=0?document.querySelectorAll(t)[0]:t.indexOf("#")<=-1||t.indexOf(".")<=-1?(p("ParseEl","Do not mount DatePicker to a pure html tag,"+t),!1):document.querySelector(t):null}function D(t){return t[0]}function y(t){return t[t.length-1]}function b(t,e){var a=r(t,e,"days");return 0===a?0:-1*a}function w(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var a={};function n(t,e){return a=t,Object.prototype.toString.call(a)==="[object "+e+"]";var a}function r(t,e){for(var a in void 0===t&&(t={}),e)e.hasOwnProperty(a)&&(t[a]=e[a]);return t}for(var i=0;i<t.length;i++){var s=t[i];if(s)if(n(s,"Array"))for(var o=0;o<s.length;o++){var l=s[o];n(l,"Object")?a=r(a,l):n(l,"Date")||(a[l]=l)}else n(s,"Object")?a=r(a,s):(n(s,"String")||n(s,"Number"))&&(a[s]=s)}return a}var M=new Date,Y=function(){function t(t){this.startDate=null,this.endDate=null,this.formatter=null,this.infiniteMode=!1,this.language={},this.views=1;var e=t.startDate,a=t.endDate,n=t.views,i=t.language,s=t.infiniteMode,o=t.dateFormatter,l=2===n?1:"auto"===n?r(e,a):0;this.language=i,this.formatter=o,this.startDate=e,this.endDate=a,this.views=n,this.infiniteMode=s,this.template=""+this.createActionBar("auto"!==this.views)+this.createView(this.createBody(l))}return t.prototype.createActionBar=function(t){return t?"<div class=\"calendar-action-bar\">\n            <button class='calendar-action calendar-action-prev'><span>prev</span></button>\n            <button class='calendar-action calendar-action-next'><span>next</span></button>\n         </div>\n    ":""},t.prototype.createBody=function(t){for(var e=[],a=0;a<=t;a++){var n=new Date(this.startDate.getFullYear(),this.startDate.getMonth()+a,1),r=this.createMonthDateTemplate(n.getFullYear(),n.getMonth());e.push({template:r.template,year:r.year,month:r.month})}return e},t.prototype.createMonthDateTemplate=function(t,e){for(var a=this,n=new Date(t,e,1),r={year:n.getFullYear(),month:n.getMonth(),date:n.getDate(),index:n.getMonth()},s=new Date(r.year,r.month,1).getDay(),o=[],l=0;l<s;l++)o.push({date:"",className:this.setNodeClassName(),text:this.createPlaceholder(),key:""});for(l=1;l<=i(r.year,r.month);l++){var d=new Date(r.year,r.month,l),c=this.formatter(d),u=c.value,h=this.createPlaceholder(c.date),f=this.setNodeClassName(d),v=c.day;o.push({className:f,text:h,key:u,day:v})}return{template:o.map(function(t){return a.createNode(t.className,t.key,t.text,t.day)}).join(" "),year:r.year,month:r.index}},t.prototype.createView=function(t){var e=this,a=this.createMonthWeek(),n=t.map(function(t){var n=t.year,r=t.month,i=e.createMonthHeader(n,r),s=e.createMonthBody(t.template),o="";return"auto"!==e.views?o+=e.createMonthWrap(i,s,a):o=e.createMonthWrap(i,s),o});return"auto"===this.views&&n.unshift(a),n.join("")},t.prototype.createMonthWrap=function(t,e,a){return'<div class="calendar-main">'+t+" "+(a||"")+" "+e+"</div>"},t.prototype.createMonthWeek=function(){return'  <div class="calendar-day">'+this.language.days.map(function(t,e){return'<div class="'+["calendar-cell","calendar-day-cell",0===e?"calendar-cell-weekday":6===e?"calendar-cell-weekend":""].join(" ")+'">'+t+"</div>"}).join("")+"</div>"},t.prototype.createMonthBody=function(t){return'<div class="calendar-body">'+t+"</div>"},t.prototype.createMonthHeader=function(t,e){var a,n,r;return'<div class="calendar-head"><div class="calendar-title">'+(a=this.language,n=t,r=e,a.year?""+n+a.year+a.months[r]:a.months[r]+" "+n)+"</div></div>"},t.prototype.createNode=function(t,e,a,n){return'<div class="'+t+'" '+(n>=0?"data-day="+n:"")+" "+(e?"data-date="+e:"")+">"+a+"</div>"},t.prototype.createPlaceholder=function(t){return'<div class="date">'+(t||"")+'</div><div class="placeholder"></div>'},t.prototype.setNodeClassName=function(t){var e=this.endDate,a=["calendar-cell","calendar-date-cell"];return t?(this.infiniteMode||(r(t,M,"days")<0&&a.push("disabled"),e&&r(t,e,"days")>0&&a.push("disabled")),0===t.getDay()&&a.push("calendar-cell-weekend"),6===t.getDay()&&a.push("calendar-cell-weekday")):a.push("disabled","empty"),a.join(" ")},t}();function S(t,e){e||(e="YYYY-MM-DD"),e=e.toUpperCase();var a={YYYY:t.getFullYear(),DD:s(t.getDate()),MM:s(t.getMonth()+1),D:t.getDate(),M:t.getMonth()+1},n=function(t){var e=t.split(/\W/,3);e.shift();for(var a=[],n=0;n<e.length;n++){var r=e[n];/\w\w/.test(r)&&a.push(r)}return e.length===a.length}(e);return{origin:t,date:n?a.DD:a.D,month:n?a.MM:a.M,year:a.YYYY,day:t.getDay(),value:e.replace(/(?:\b|%)([dDMyY]+)(?:\b|%)/g,function(t,e){return void 0===a[e]?e:a[e]})}}function F(t,e){e||(e="YYYY-MM-DD");var a=function(t){if(!t)return new Date;if(t instanceof Date)return t;var e=new Date(t);return e.getTime()?new Date(e.getFullYear(),e.getMonth(),e.getDate()):null}(t);if(a)return a;var n=/d{1,4}|M{1,4}|YY(?:YY)?|S{1,3}|Do|ZZ|([HhMsDm])\1?|[aA]|"[^"]*"|'[^']*'/g,r={D:[/\d{1,2}/,function(t,e){return t.day=parseInt(e)}],M:[/\d{1,2}/,function(t,e){return t.month=parseInt(e)-1}],DD:[/\d{2}/,function(t,e){return t.day=parseInt(e)}],MM:[/\d{2}/,function(t,e){return t.month=parseInt(e)-1}],YY:[/\d{2,4}/,function(t,e){return t.year=parseInt(e)}],YYYY:[/\d{2,4}/,function(t,e){return t.year=parseInt(e)}]};return(a=function(t,e){if(t.length>1e3)return null;var a=!0,i={year:0,month:0,day:0};if(e.replace(n,function(e){if(r[e]){var n=r[e],s=n[0],o=n[n.length-1],l=t.search(s);~l?t.replace(n[0],function(e){return o(i,e),t=t.substr(l+e.length),e}):a=!1}return r[e]?"":e.slice(1,e.length-1)}),!a)return null;var s=new Date(i.year,i.month,i.day);return new Date(s.getFullYear(),s.getMonth(),s.getDate())})(t,e)}var k=new Date,N=new Date(k.getFullYear(),k.getMonth(),k.getDate());function j(t,e,n){if(n)for(var r=e.querySelectorAll(".in-range"),i=0;i<r.length;i++)f(r[i],"in-range");else for(i=0;i<t.length;i++){var s=a("data-date",t[i]),o=e.querySelector(s);u(o,"active")||h(o,"in-range")}}function O(t){var e=t.collector,i=t.collection,s=t.data,o=t.isDouble,l=t.parse,d=t.format,c=t.inDates,u=t.isInit,f=[];if(o){if(s.length>=2){var v=s[0],g=s[s.length-1];c(v)||(s=[]);for(var p=l(v),m=l(g),D=p.getFullYear(),y=p.getMonth(),b=p.getDate(),w=[],M=r(m,p,"days")+1,Y=0;Y<M;Y++){var S=d(new Date(D,y,b+Y)).value;c(S)||w.push(S)}w.length>=2&&(s=[])}(s.length>0&&u||!u)&&(f=function(t,e,a,i){for(var s=[],o=a[0],l=a[a.length-1],d=0;d<t.length;d++){var c=t[d],u=t[d+1];if(a.length>0){var f=n(t[d],"data-date");f===o?h(c,"start-date"):f===l&&h(c,"end-date")}else if(c&&u){var v=n(c,"data-date"),g=n(u,"data-date");v&&g&&r(i(v),N,"days")>=0&&(e(g)&&e(v)||e(v)&&!e(g))&&s.length<2&&(h(c,"start-date"),h(u,"end-date"),s.push(v,g))}}return a.length>0&&(s=a),s}(i,c,s,l));var F=function(t,e,a){for(var r=[],i=0;i<t.length;i++){var s=n(t[i],"data-date");s&&r.push(s)}var o=-1,l=-1;for(i=0;i<r.length;i++){var d=r[i];d===e?o=i:d===a&&(l=i)}return l===o||l<0?[]:r.slice(o+1,l)}(i,f[0],f[f.length-1]);F.length>0&&j(F,e,!1)}else f=s;for(Y=0;Y<f.length;Y++){var k=a("data-date",f[Y]);h(e.querySelector(k),"active")}return f}var x=function(t){for(var e=t.element,r=t.selected,i=t.isDouble,s=t.limit,o=t.inDates,l=t.bindData,d=t.dateFormat,c=t.emitter,v=e.querySelectorAll(".calendar-date-cell"),g=r,p=function(t){var p=v[t];p.addEventListener("click",function(){var t,v,m,w,M,Y,k,N=n(p,"data-date"),O=r.indexOf(N),x=F(N,d),A=S(new Date(x.getFullYear(),x.getMonth(),x.getDate()-1),d).value,q=o(A);if(!N||r.length<=0&&!o(N)&&l||i&&!q&&!o(N)||O>=0&&!o(N))return!1;if(O>=0&&(r=o(y(r))?[y(r)]:[D(r)]),(i&&r.length>=2||!i)&&(r=[]),r.push(N),i){var I={start:D(r),end:y(r)};b(F(I.start,d),F(I.end,d))<0?o(I.end)?r=[N]:r.pop():o(I.end)||q||(r=[I.start]);for(var E={start:D(($=function(t,e){var a=t.selected,n=D(a),r=y(a),i=F(n,t.dateFormat),s=F(r,t.dateFormat),o=[];n===r&&a.length>=2&&a.pop();var l=b(i,s);if(l>0)if(l<=t.limit)for(var d=1;d<l;d++){var c=S(new Date(i.getFullYear(),i.getMonth(),i.getDate()+d),t.dateFormat).value;o.push(c)}else e(r)?a.shift():a.pop();else l<=0&&a.length>=2&&a.pop();return{dates:o,selected:a}}({date:N,dateFormat:d,selected:r,limit:s},o)).selected),end:y($.selected)},L=b(F(E.start,d),F(E.end,d)),P=$.dates,R=[],T=[],B=0,C=P;B<C.length;B++){var W=C[B];o(W)?R.push(W):T.push(W)}T.length>0&&($.selected.pop(),E.end=null),t=e,v=E.start,m=E.end,w=L,M=L>s||L<0,Y={start:t.querySelector(".start-date"),end:t.querySelector(".end-date")},k={start:t.querySelector(a("data-date",v)),end:t.querySelector(a("data-date",m))},0===w?u(k.start,"disabled")||(f(Y.start,"start-date"),f(Y.start,"active"),f(Y.end,"end-date"),f(Y.end,"active"),h(k.start,"active"),h(k.start,"start-date")):(h(k.end,"active"),w>0?M?(h(k.end,"start-date"),f(Y.start,"start-date"),f(Y.start,"active")):v&&!m?(f(Y.start,"active"),f(Y.start,"start-date"),h(k.start,"active"),h(k.start,"start-date")):m&&v!==m&&(h(k.end,"active"),h(k.end,"end-date")):w<0&&(f(k.start,"active"),f(k.start,"start-date"),h(k.end,"start-date"))),l?T.length<=0&&j(R,e,P.length<=0):j(R,e,P.length<=0),r=$.selected}else{var $=function(t,e,a,n){if(a){for(var r=e.querySelectorAll(".active"),i=0;i<r.length;i++)f(r[i],"active");return u(t,"disabled")||h(t,"active"),n}return[]}(p,e,o(N),r);r=$.length>0?$:g}c("select",{type:"selected",value:r})})},m=0;m<v.length;m++)p(m)};return function(){function t(t){var a=this;if(this.limit=1,this.views=1,this.date=new Date,this.startDate=null,this.endDate=null,this.dates=[],this.selected=[],this.currentSelection=[],this.data={},this.disables={},this.language={days:["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"],months:["01\u6708","02\u6708","03\u6708","04\u6708","05\u6708","06\u6708","07\u6708","08\u6708","09\u6708","10\u6708","11\u6708","12\u6708"],year:"\u5e74"},this.element=null,this.double=!1,this.bindData=!1,this.infiniteMode=!1,this.isInit=!1,this.on=e.$on,this.format=function(t,e){return S(t,e||a.dateFormat)},this.parse=function(t,e){return F(t,e||a.dateFormat)},this.inDates=function(t){return a.dates.indexOf(t)>=0},this.update=function(t){var e=t.type,n=t.value;"selected"===e?a.setDates(n):"switch"===e&&a.currentSelection.length>0&&(a.selected=a.currentSelection),"disabled"!==e&&"switch"!==e&&a.emit("update",t)},!t)return{diff:this.diff,parse:this.parse,format:function(t,e){return a.format(t,e).value}};this.init(t)}return t.prototype.emit=function(t,a){return e.$emit(t,a)},t.prototype.currentRange=function(t){var e=this.currentSelection.length>0?this.currentSelection:this.double?this.selected:[this.format(this.date).value];return O({collector:this.element,collection:this.element.querySelectorAll(".calendar-date-cell:not(.empty)"),data:e,isDouble:this.double,parse:this.parse,format:this.format,inDates:this.inDates,disables:this.disables,isInit:t})},t.prototype.doMonthSwitch=function(t){var e={year:this.date.getFullYear(),month:this.date.getMonth(),date:this.date.getDate()};this.date=new Date(e.year,e.month+t,e.date),this.isInit=!1,this.createDatePicker(!1)},t.prototype.bindMonthSwitch=function(){var t=this,e=this.element.querySelector(".calendar-action-prev"),a=this.element.querySelector(".calendar-action-next");e&&a&&(this.infiniteMode?(a.addEventListener("click",function(){return t.doMonthSwitch(1)}),e.addEventListener("click",function(){return t.doMonthSwitch(-1)})):(r(this.date,this.endDate)>=1?a.addEventListener("click",function(){t.doMonthSwitch(1),f(e,"disabled"),f(e,"calendar-action-disabled")}):(h(a,"disabled"),h(a,"calendar-action-disabled")),r(this.date,this.startDate)>=1?e.addEventListener("click",function(){t.doMonthSwitch(-1),f(a,"disabled"),f(a,"calendar-action-disabled")}):(h(e,"disabled"),h(e,"calendar-action-disabled"))))},t.prototype.pickDate=function(){x({dateFormat:this.dateFormat,element:this.element,selected:this.selected,isDouble:this.double,limit:this.limit,bindData:this.bindData,emitter:this.emit,inDates:this.inDates})},t.prototype.dataRenderer=function(){var t=this;if(Object.keys(this.data).length>0)var e=v(function(){t.emit("data",{data:t.data,nodeList:t.element.querySelectorAll(".calendar-cell")}),g(e)})},t.prototype.setDates=function(t){var e=this;if(l(t)){var a=[],n="",i="";if(this.double){t.length>2&&(t=t.slice(0,2)),n=t[0],i=t[t.length-1];var s=c(n)?n:this.parse(n),o=c(i)?i:this.parse(i),d=-1*r(s,o,"days");if(this.bindData)if(!function(a,n,r){if(r<0||r>e.limit||!e.inDates(e.format(a).value)&&!e.inDates(e.format(n).value)||!e.inDates(e.format(a).value))return p("setDates","Illegal dates,["+t+"]"),!1;for(var i=0;i<=r;i++){var s=new Date(a.getFullYear(),a.getMonth(),a.getDate()+i),o=e.format(s).value;if(i<r&&!e.inDates(o))return p("setDates","Illegal date,{dates:["+o+"]}"),!1}return!0}(s,o,d))return!1;a=[this.format(s).value,this.format(o).value]}else{var u=t[t.length-1];a=[c(u)?this.format(u).value:u]}this.currentSelection=a}else p("setDates","no dates provided,"+(t=[]))},t.prototype.setLanguage=function(t){return l(t.days)&&l(t.months)&&(this.language=t),!1},t.prototype.disable=function(){var t=this;if(Object.keys(this.disables).length>0)var e=v(function(){t.emit("disabled",{nodeList:t.element.querySelectorAll(".calendar-cell"),dateList:t.disables}),g(e)})},t.prototype.setDisabled=function(t){if(!t||d(t)&&Object.keys(t).length<=0)return p("setDisabled","invalid params, \nparams should be {dates:<Array<any>>[], days:<Array<number>>[] }"),!1;if(!l(t.dates)&&!l(t.days))return p("setDisabled","invalid params  { dates:<Array<any>>"+t.dates+", days:<Array<number>>"+t.days+" }"),!1;var e={},a=[];if(l(t.dates))for(var n=0,r=t.dates;n<r.length;n++){c(m=r[n])?a.push(this.format(m).value):a.push(m)}if(l(t.days))for(var i=0,s=t.days;i<s.length;i++){var o=s[i],u=this.element.querySelectorAll('[data-day="'+o+'"');if(u)for(var h=0,f=u;h<f.length;h++){(m=f[h].getAttribute("data-date"))&&a.push(m)}}for(var v=0,g=a;v<g.length;v++){var m;e[m=g[v]]=m}this.disables=e},t.prototype.setData=function(t){var e,a=this;if("[object Function]"===o(t)){var n=t();!d(e=n)||Object.keys(e).length<=0||(this.data=n,this.dates=Object.keys(n).sort(function(t,e){return a.parse(t)-a.parse(e)}))}},t.prototype.diff=function(t,e){return r(t,e,"days")},t.prototype.createDatePicker=function(t){(this.element.innerHTML=new Y({startDate:this.date,endDate:this.endDate,language:this.language,infiniteMode:this.infiniteMode,dateFormatter:this.format,views:this.views}).template,this.selected=this.currentRange(this.isInit),1===this.views)&&(this.double&&this.selected.length>=2&&this.selected[0]===this.selected[this.selected.length-1]&&this.selected.pop());var e={type:t?"init":"switch",value:this.selected};this.bindMonthSwitch(),this.disable(),this.pickDate(),this.dataRenderer(),this.update(e)},t.prototype.init=function(t){var e=this,a=new Date;if(t.doubleSelect&&(this.double=t.doubleSelect),this.dateFormat=t.format,this.views=function(t){if(!t)return 1;var e=parseInt(t,10);return isNaN(e)?"auto"!==t?1:"auto":e>2||e<=0?1:e}(t.views),this.startDate=c(t.from)?t.from:new Date,this.endDate=c(t.to)?t.to:new Date(this.startDate.getFullYear(),this.startDate.getMonth()+6,0),this.date=this.startDate,this.limit=this.double?"[object Number]"===o(t.limit)?t.limit:2:1,this.element=m(t.el),!this.element)return p("init","invalid selector,current selector "+this.element),!1;this.element.className=this.element.className+" calendar calendar-"+(2===this.views?"double-views":1===this.views?"single-view":"flat-view");var n=v(function(){if(e.isInit=e.currentSelection.length>0,e.bindData=Object.keys(e.data).length>0,c(t.from)&&c(t.to)||(e.infiniteMode=!0,e.bindData&&p("init","infiniteMode is on, please provide [from] and [to] while binding data to datepicker  ")),!e.bindData)if(c(t.from)&&c(t.to)){for(var s=r(e.endDate,a,"days"),o=a.getFullYear(),l=a.getMonth(),d=a.getDate(),u=[],h=0;h<s;h++){var f=new Date(o,l,d+h),v=e.format(f).value;u.push(v)}e.dates=u}else e.views=1;var m=function(t,e,a){for(var n=t.getDate(),r={},s=1;s<=n-1;s++)r[l=S(new Date(t.getFullYear(),t.getMonth(),n-s),a).value]=l;var o=i(e.getFullYear(),e.getMonth())-e.getDate();for(s=1;s<=o;s++){var l;r[l=S(new Date(e.getFullYear(),e.getMonth(),e.getDate()+s),a).value]=l}return r}(e.startDate,e.endDate,e.dateFormat);e.disables=w(m,e.disables);var D=Object.keys(e.disables);if(D.length>0){var y=e.dates,b=[],M=function(t,e){var a={};for(var n in e)t.indexOf(n)>=0&&(a[n]=n);return a}(D,e.data);if(Object.keys(M).length>0)for(var Y in M)delete e.data[Y];for(var F=0,k=y;F<k.length;F++){M[d=k[F]]||b.push(d)}e.dates=b}"auto"===e.views&&(e.currentSelection.length>0?e.date=e.parse(e.currentSelection[0]):e.dates.length>0&&(e.date=e.parse(e.dates[0]))),e.createDatePicker(!0),e.on("select",e.update),g(n)})},t}()});