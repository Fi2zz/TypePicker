!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.DatePicker=t()}(this,function(){"use strict";var e,t=(e={},{$on:function(t,a){e[t]||(e[t]=[]),e[t].push(a)},$emit:function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];var n=[].shift.call(t),i=e[n];if(!i||0===i.length)return!1;for(var r=0,l=void 0;l=i[r++];)l.apply(this,t)},$remove:function(t,a){var n=e[t];if(!n)return!1;if(a)for(var i=n.length-1;i>=0;i--)n[i]===a&&n.splice(i,1);else n&&(n.length=0)}});function a(e,t,a){if(void 0===a&&(a="month"),e||(e=new Date),t||(t=new Date),"month"===a)return Math.abs(12*e.getFullYear()+e.getMonth()-(12*t.getFullYear()+t.getMonth()));if("days"===a){var n=new Date(e.getFullYear(),e.getMonth(),e.getDate()),i=new Date(t.getFullYear(),t.getMonth(),t.getDate());return Math.round(n-i)/864e5}}var n=function(e,t){return"["+e+'="'+t+'"]'},i=function(e,t){var a=new Date(e,t,1),n=Date.UTC(a.getFullYear(),a.getMonth()+1,0);return new Date(n).getUTCDate()},r=function(e){return""+(e>9?e:"0"+e)},l=function(e,t){return new Date(e,t,1).getDay()};function s(e,t,a){if(void 0===a&&(a=void 0),!e)return null;var n=e.getAttribute(t);return void 0===a&&(a=""),n||e.setAttribute(t,a)}var d=function(e){return Object.prototype.toString.call(e)};function o(e){return"[object Array]"===d(e)}function u(e){return"[object Object]"===d(e)}function c(e){return"[object Date]"===d(e)}function h(e,t){return!!(e&&t&&e.className&&-1!=e.className.search(new RegExp("\\b"+t+"\\b")))}function f(e,t){!e||!t||e.className&&-1!=e.className.search(new RegExp("\\b"+t+"\\b"))||(e.className+=(e.className?" ":"")+t)}function g(e,t){!e||!t||e.className&&-1==e.className.search(new RegExp("\\b"+t+"\\b"))||(e.className=e.className.replace(new RegExp("\\s*\\b"+t+"\\b","g"),""))}var v={locale:"zh-cn",pack:{days:["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"],months:["01\u6708","02\u6708","03\u6708","04\u6708","05\u6708","06\u6708","07\u6708","08\u6708","09\u6708","10\u6708","11\u6708","12\u6708"],year:"\u5e74"}};function m(e){window.setTimeout(e,0)}function D(e){window.clearTimeout(e)}function p(e,t){var a=t;(u(t)||o(t))&&(a=JSON.stringify(t)),console.error("["+e+"] "+a+" ")}var w=new Date;function y(e){var t=e.date,n=e.infiniteMode,i=e.endDate,r=["calendar-cell","calendar-date-cell"];return t?(n||(a(t,w,"days")<0&&r.push("disabled"),i&&a(t,i,"days")>0&&r.push("disabled")),0===t.getDay()&&r.push("calendar-cell-weekend"),6===t.getDay()&&r.push("calendar-cell-weekday")):r.push("disabled","empty"),r.join(" ")}function b(e){for(var t=e.year,a=e.month,n=e.infiniteMode,r=e.formatter,s=e.endDate,d=[],o=new Date(t,a,1),u={year:o.getFullYear(),month:o.getMonth(),date:o.getDate(),index:o.getMonth()},c=l(u.year,u.month),h=0;h<c;h++)d.push({date:"",className:y({}),text:M(),key:""});for(h=1;h<=i(u.year,u.month);h++){var f=new Date(u.year,u.month,h),g=r(f),v=g.value,m=M(g.date),D=y({date:f,infiniteMode:n,endDate:s});d.push({className:D,text:m,key:v})}return{template:d.map(function(e){return t=e.className,a=e.key,n=e.text,'<div class="'+t+'"'+(a?"data-date="+a:"")+">"+n+"</div>";var t,a,n}).join(" "),year:u.year,month:u.index}}function M(e){return'<div class="date">'+(e||"")+'</div><div class="placeholder"></div>'}function Y(e){var t,n,i,r,l,s,d,o,u=e.startDate,c=e.endDate,h=e.multiViews,f=e.flatView,g=e.singleView,v=e.language,m=e.infiniteMode,D=e.parse,p=e.formatter,w={template:function(e){for(var t=e.startDate,a=e.endDate,n=e.gap,i=e.infiniteMode,r=e.formatter,l=e.parse,s=[],d=0;d<=n;d++){var o=new Date(t.getFullYear(),t.getMonth()+d,1),u=b({year:o.getFullYear(),month:o.getMonth(),formatter:r,parse:l,infiniteMode:i,endDate:a});s.push({template:u.template,year:u.year,month:u.month})}return s}({startDate:u,endDate:c,gap:h?1:f?a(u,c):0,infiniteMode:m,formatter:p,parse:D}),multiViews:h,flatView:f,language:v,singleView:g};return(h||g?"<div class=\"calendar-action-bar\">\n            <button class='calendar-action calendar-action-prev'><span>prev</span></button>\n            <button class='calendar-action calendar-action-next'><span>next</span></button>\n         </div>\n    ":"")+(n=(t=w).template,i=t.multiViews,r=t.flatView,l=t.singleView,s=t.language,d=s.week.map(function(e,t){return'<div class="'+["calendar-cell","calendar-day-cell",0===t?"calendar-cell-weekday":6===t?"calendar-cell-weekend":""].join(" ")+'">'+e+"</div>"}).join(""),o=n.map(function(e){var t=e.year,a=e.month,n='<div class="calendar-title">'+s.title(t,a)+"</div>",r=e.template,o="";return i||l?o+="<div class='calendar-main'>\n                    <div class=\"calendar-head\">"+n+'</div>\n                   <div class="calendar-day"> '+d+'</div>\n                    <div class="calendar-body">'+r+"</div>\n              </div>":o='<div class="calendar-main">\n                   <div class="calendar-head">'+n+'</div>  \n                    <div class="calendar-body">'+r+"</div>\n            </div>",o}),r&&o.unshift('<div class="calendar-day">'+d+"</div>"),o.join(""))}var V=new Date,S=new Date(V.getFullYear(),V.getMonth(),V.getDate());function k(e,t,a,i){if(a)for(var r=t.querySelectorAll(".in-range"),l=0;l<r.length;l++)g(r[l],"in-range");else for(l=0;l<e.length;l++){var s=n("data-date",e[l]),d=t.querySelector(s);h(d,"active")||f(d,"in-range")}if(i)return[]}function F(e){var t=e.collector,i=e.collection,r=e.data,l=e.isDouble,d=e.parse,o=e.format,u=e.inDates,c=e.isInit,h=[];if(l){if(r.length>=2){var g=r[0],v=r[r.length-1];u(g)||(r=[]);for(var m=d(g),D=d(v),p=m.getFullYear(),w=m.getMonth(),y=m.getDate(),b=[],M=a(D,m,"days")+1,Y=0;Y<M;Y++){var V=o(new Date(p,w,y+Y)).value;u(V)||b.push(V)}b.length>=2&&(r=[])}(r.length>0&&c||!c)&&(h=function(e,t,n,i){for(var r=[],l=n[0],d=n[n.length-1],o=0;o<e.length;o++){var u=e[o],c=e[o+1];if(n.length>0){var h=s(e[o],"data-date");h===l?f(u,"start-date"):h===d&&f(u,"end-date")}else if(u&&c){var g=s(u,"data-date"),v=s(c,"data-date");g&&v&&a(i(g),S,"days")>=0&&(t(v)&&t(g)||t(g)&&!t(v))&&r.length<2&&(f(u,"start-date"),f(c,"end-date"),r.push(g,v))}}return n.length>0&&(r=n),r}(i,u,r,d));var F=function(e,t,a){for(var n=[],i=0;i<e.length;i++){var r=s(e[i],"data-date");r&&n.push(r)}var l=-1,d=-1;for(i=0;i<n.length;i++){var o=n[i];o===t?l=i:o===a&&(d=i)}return d===l||d<0?[]:n.slice(l+1,d)}(i,h[0],h[h.length-1]);F.length>0&&k(F,t,!1)}else h=r;for(Y=0;Y<h.length;Y++){var x=n("data-date",h[Y]);f(t.querySelector(x),"active")}return h}function x(e,t,a){void 0===a&&(a=!0);var n=a;t||(t="YYYY-MM-DD");var i={DD:n?r(e.getDate()):e.getDate(),dd:n?r(e.getDate()):e.getDate(),MM:n?r(e.getMonth()+1):e.getMonth()+1,mm:n?r(e.getMonth()+1):e.getMonth()+1,YYYY:e.getFullYear(),D:e.getDate(),d:e.getDate(),M:e.getMonth()+1,m:e.getMonth()+1};return{origin:e,date:n?i.DD:i.D,month:n?i.MM:i.M,year:i.YYYY,day:e.getDay(),value:t.replace(/(?:\b|%)([dDMyYHhaAmsz]+|ap|AP)(?:\b|%)/g,function(e,t){return void 0===i[t]?t:i[t]})}}function R(e,t){t||(t="YYYY-MM-DD");var a=function(e){if(!e)return new Date;if(e instanceof Date)return e;var t=new Date(e);return t.getTime()?new Date(t.getFullYear(),t.getMonth(),t.getDate()):null}(e);if(a)return a;var n=/d{1,4}|M{1,4}|YY(?:YY)?|S{1,3}|Do|ZZ|([HhMsDm])\1?|[aA]|"[^"]*"|'[^']*'/g,i={D:[/\d{1,2}/,function(e,t){return e.day=parseInt(t)}],M:[/\d{1,2}/,function(e,t){return e.month=parseInt(t)-1}],DD:[/\d{2}/,function(e,t){return e.day=parseInt(t)}],MM:[/\d{2}/,function(e,t){return e.month=parseInt(t)-1}],YY:[/\d{2,4}/,function(e,t){return e.year=parseInt(t)}],YYYY:[/\d{2,4}/,function(e,t){return e.year=parseInt(t)}]};return(a=function(e,t){if(e.length>1e3)return null;var a=!0,r={year:0,month:0,day:0};if(t.replace(n,function(t){if(i[t]){var n=i[t],l=n[0],s=n[n.length-1],d=e.search(l);~d?e.replace(n[0],function(t){return s(r,t),e=e.substr(d+t.length),t}):a=!1}return i[t]?"":t.slice(1,t.length-1)}),!a)return null;var l=new Date(r.year,r.month,r.day);return new Date(l.getFullYear(),l.getMonth(),l.getDate())})(e,t)}function N(e){var t={year:this.date.getFullYear(),month:this.date.getMonth(),date:this.date.getDate()},a=t.month+e;this.multiViews&&(a+=e>0?1:-1),this.defaultDates.length>0&&(this.selected=this.defaultDates),this.date=new Date(t.year,a,t.date),this.createDatePicker(!1),this.pickDate(),this.dataRenderer(this.data)}function j(e){this.element.innerHTML=Y({startDate:this.date,endDate:this.endDate,multiViews:this.multiViews,flatView:this.flatView,singleView:this.singleView,language:this.language,infiniteMode:this.infiniteMode,formatter:this.format,parse:this.parse}),this.bindMonthSwitch(this.language),this.selected=this.currentRange(this.isInitRange);var t={type:"init",value:this.selected};e&&this.update(t)}function q(e){var t=this.defaultDates.length>0?this.defaultDates:this.double?this.selected:[this.format(this.date).value];return F({collector:this.element,collection:this.element.querySelectorAll(".calendar-date-cell:not(.empty)"),data:t,isDouble:this.double,parse:this.parse,format:this.format,inDates:this.inDates,isInit:e})}function I(){var e=this,t=this.element.querySelector(".calendar-action-prev"),n=this.element.querySelector(".calendar-action-next");if(t&&n)if(this.infiniteMode)n.addEventListener("click",function(){e.monthSwitch(1)}),t.addEventListener("click",function(){e.monthSwitch(-1)});else{var i=a(this.date,this.endDate),r=a(this.date,this.startDate);i>=2?n.addEventListener("click",function(){e.monthSwitch(1),g(t,"disabled"),g(t,"calendar-action-disabled")}):(f(n,"disabled"),f(n,"calendar-action-disabled")),r>=2?t.addEventListener("click",function(){e.monthSwitch(-1),g(n,"disabled"),g(n,"calendar-action-disabled")}):(f(t,"disabled"),f(t,"calendar-action-disabled"))}}function P(e,t){var n,i,r,l,s,o,u,h,f=this;if(e.initWithSelected&&(this.initWithSelected=e.initWithSelected),e.doubleSelect&&(this.double=e.doubleSelect),e.format&&(this.dateFormat=e.format||"YYYY-MM-DD"),!e.multiViews||e.flatView||e.singleView?!e.flatView||e.singleView||e.multiViews?!e.singleView||e.multiViews||e.flatView||(this.singleView=!0):this.flatView=!0:this.multiViews=!0,this.startDate=c(e.from)?e.from:new Date,this.date=this.startDate,this.endDate=c(e.to)?e.to:new Date(this.date.getFullYear(),this.date.getMonth()+6,0),this.limit=this.double?(n=e.limit,"[object Number]"===d(n)?e.limit:1):1,e.zeroPadding&&(this.zeroPadding=e.zeroPadding),e.infiniteMode&&(this.infiniteMode=e.infiniteMode),!t.dates||t.dates&&t.dates.length<=0){for(var g=new Date,w=a(this.endDate,g,"days"),y=g.getFullYear(),b=g.getMonth(),M=g.getDate(),Y=[],V=0;V<w;V++){var S=new Date(y,b,M+V),k=this.format(S).value;Y.push(k)}this.data={},this.dates=Y}else this.dates=t.dates,this.data=t.data,this.infiniteMode=!1;if(this.format=function(e){return x(e,f.dateFormat,f.zeroPadding)},this.language=(o=e.language,u=e.defaultLanguage,i=u&&o[u]?{locale:u,pack:o[u]}:v,r=i.locale.toLowerCase(),l=i.pack,s=l.months,{week:l.days,title:"en"===r||"en-us"===r||"en-gb"===r?function(e,t){return s[t]+" "+e}:function(e,t){return""+e+l.year+s[t]}}),this.element=(h=e.el)?h.indexOf("#")>=0?document.querySelector(h):h.indexOf(".")>=0?document.querySelectorAll(h)[0]:h.indexOf("#")<=-1||h.indexOf(".")<=-1?(p("ParseEl ","do not mount DatePicker to a pure html tag,"+h),!1):document.querySelector(h):null,!this.element)return p("init","invalid selector,current selector "+this.element),!1;this.element.className=this.element.className+" calendar calendar-"+(this.multiViews?"double-views":this.singleView?"single-view":"flat-view");var F=m(function(){if(f.defaultDates.length>0){var e=f.defaultDates[0];f.flatView||(f.date=f.parse(e))}f.createDatePicker(!0),f.pickDate(),D(F)})}var A=function(e){for(var t=e.element,a=e.selected,i=e.isDouble,r=e.parse,l=e.format,d=e.limit,o=e.inDates,u=e.update,c=e.infiniteMode,v=e.bindData,m=a,D=t.querySelectorAll(".calendar-date-cell"),p=function(e){var p=D[e];p.addEventListener("click",function(){var e=a,D=s(p,"data-date"),w=a.indexOf(D);if(!D||a.length<=0&&!o(D)&&v)return!1;if(w>=0&&(a=[a[0]]),(i&&a.length>=2||!i)&&(a=[]),a.push(D),i){var y=function(e){var t=e.selected,a=e.date,n=e.cache,i=e.limit,r=e.format,l=e.parse,s=e.inDates,d=e.bindData,o=[],u=[],c=!1,h=t[0],f=t[t.length-1],g=l(h),v=l(f);if(d){var m=O(g,v),D=t.length;if(D>=2)if(m<=0)s(a)?t.shift():t=[t[0]];else if(s(f))for(var p=g.getFullYear(),w=g.getMonth(),y=g.getDate(),b=1;b<m;b++){var M=new Date(p,w,y+b),Y=r(M).value;s(Y)&&u.push(Y),o.push(Y)}else s()&&f&&(t.shift(),o.push(f));else if(1===D){var V=t[t.length-1];if(s(V))t=[V];else if(n.length>=2){for(var S=[],b=0;b<n.length;b++)s(n[b])&&S.push(n[b]);if(S.length===n.length){var k=n[0],F=n[n.length-1];t=k!==F?n:[k]}else t=[]}else t=[n[0]]}else t=n;if(t.length<=0&&(t=n),(c=o.length===u.length)||(t=[t[t.length-1]]),2===t.length){var x=null,R=t[t.length-1],N=l(R),j=l(t[0]),q=-1*O(N,j);if(q>0){var p=j.getFullYear(),w=j.getMonth(),I=j.getDate();o=[],u=[];for(var b=0;b<q;b++){var M=new Date(p,w,I+b),P=r(M).value;s(P)&&(x=M,u.push(P)),~o.indexOf(P)||o.push(P)}var A=O(x,N);1===A||-1===A?c=!0:(o=[],t=[t[0]],c=!1)}if(u.length===o.length?c=!0:(c=!1,t=[t[0]]),o.length>i){c=!1;var E=t[t.length-1];t=s(E)?[E]:[n[0]]}}}else{t.length>=2&&h===f&&t.pop();var L=O(g,v);if(L>0&&L<=i){for(var b=1;b<L;b++){var z=new Date(g.getFullYear(),g.getMonth(),g.getDate()+b);o.push(r(z).value)}c=!0}else(L>i||L<0)&&t.shift()}return{selected:t,allValid:c,range:o}}({date:D,selected:a,cache:e,limit:d,format:l,parse:r,inDates:o,infiniteMode:c,bindData:v});a=y.selected;var b=y.range,M=y.allValid,Y=a[0],V=a[a.length-1],S=O(r(Y),r(V)),F=function(e,t,a,i,r,l){var s={start:e.querySelector(".start-date"),end:e.querySelector(".end-date")},d={start:e.querySelector(n("data-date",t)),end:e.querySelector(n("data-date",a))};{if(0===i)return!h(d.start,"disabled")&&(g(s.start,"start-date"),g(s.start,"active"),g(s.end,"end-date"),g(s.end,"active"),f(d.start,"active"),f(d.start,"start-date"),!0);f(d.end,"active"),i>0?r?(f(d.end,"start-date"),g(s.start,"start-date"),g(s.start,"active")):l?f(d.end,"end-date"):(g(d.start,"active"),g(d.start,"start-date"),f(d.end,"start-date")):i<0&&(g(d.start,"active"),g(d.start,"start-date"),f(d.end,"start-date"))}return!0}(t,Y,V,S,S>d,M);F&&k([],t,!0),M&&F&&k(b,t,!1)}else{var x=p,R=!0;o(D)||(a=e,R=!1),function(e,t,a){if(a){for(var n=t.querySelectorAll(".active"),i=0;i<n.length;i++)g(n[i],"active");h(e,"disabled")||f(e,"active")}}(x,t,R)}var N=i&&m.join("-")===a.join("-")?"disabled":"selected";u({type:N,value:a})})},w=0;w<D.length;w++)p(w)};function O(e,t){var n=a(e,t,"days");return 0===n?0:-1*n}function E(e,t){var a,n=this;if(e.bindData){var i={dates:[],data:{},from:Date,to:Date},r=t&&t(i),l=r||i;c(i.from)&&(e.from=i.from),c(i.to)&&(e.to=i.to);var s={data:l.data,dates:l.dates.sort(function(e,t){return n.parse(e)-n.parse(t)})};this.init(e,s),!u(a=l)||Object.keys(a.data).length<=0||a.dates.length<=0||this.dataRenderer(l.data)}}return function(){return function(e){var n=this;return this.init=P,this.date=new Date,this.limit=1,this.double=!1,this.element=null,this.startDate=new Date,this.endDate=null,this.selected=[],this.flatView=!1,this.multiViews=!1,this.singleView=!1,this.monthSwitch=N,this.createDatePicker=j,this.zeroPadding=!1,this.initWithSelected=!1,this.bindData=!1,this.infiniteMode=!1,this.currentRange=q,this.isInitRange=!1,this.language={},this.pickDate=function(){A({element:n.element,selected:n.selected,isDouble:n.double,source:n.dates,parse:n.parse,format:n.format,limit:n.limit,inDates:n.inDates,update:n.update,infiniteMode:n.infiniteMode,bindData:n.bindData})},this.format=function(e){return x(e,n.dateFormat,n.zeroPadding)},this.parse=function(e){return R(e,n.dateFormat)},this.inDates=function(e){return n.dates.indexOf(e)>=0},this.update=function(e){"selected"===e.type&&n.dateRanges(e.value,!1),t.$emit("update",e)},this.dataRenderer=function(e){if(Object.keys(e).length<=0)t.$remove("data");else var a=m(function(){t.$emit("data",{data:e,nodeList:n.element.querySelectorAll(".calendar-cell")}),D(a)})},this.dateRanges=function(e,t){if(o(e)){n.isInitRange=!!t;var i=function(){var t=[],i="",r="";if(n.double){e.length>2&&(e=e.slice(0,2)),i=e[0],r=e[e.length-1];var l=c(i)?i:n.parse(i),s=c(r)?r:n.parse(r),d=-1*a(l,s,"days");if(n.bindData&&(d<0||d>n.limit||!n.inDates(n.format(l).value)&&!n.inDates(n.format(s).value)||!n.inDates(n.format(l).value)))return p("dateRanges","Illegal dates,["+e+"]"),!1;for(var o=0;o<=d;o++){var u=new Date(l.getFullYear(),l.getMonth(),l.getDate()+o),h=n.format(u).value;if(o<d&&!n.inDates(h))return p("dateRanges","Illegal date,{dates:["+h+"]}"),!1}t=[n.format(l).value,n.format(s).value]}else{var f=e[e.length-1];t=[c(f)?n.format(f).value:f]}n.defaultDates=t};if(n.bindData)var r=m(function(){i(),D(r)});else i()}else p("dateRanges","no dates provided,"+(e=[]))},this.bindMonthSwitch=I,this.initWithDataBind=E,this.utils={format:function(e,t){return e&&t?x(e,t).value:null},parse:function(e,t){return e&&t?R(e,t):new Date},diff:function(e,t){return a(e,t,"days")}},e?(this.defaultDates=[],this.bindData=e.bindData,!e.bindData&&e.el&&this.init(e,{}),{on:t.$on,data:function(t){return n.initWithDataBind(e,t)},diff:function(e,t){return a(e,t,"days")},parse:this.parse,format:this.format,dateRanges:this.dateRanges,setDefaultDates:this.dateRanges}):{format:function(e,t){return e&&t?x(e,t).value:null},parse:function(e,t){return e&&t?R(e,t):new Date},diff:function(e,t){return a(e,t,"days")}}}}()});